const fr_FR={dateTime:"%A, le %e %B %Y, %X",date:"%d/%m/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],shortDays:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],months:["janvier","f\xE9vrier","mars","avril","mai","juin","juillet","ao\xFBt","septembre","octobre","novembre","d\xE9cembre"],shortMonths:["janv.","f\xE9vr.","mars","avr.","mai","juin","juil.","ao\xFBt","sept.","oct.","nov.","d\xE9c."]},FR=d3.locale(fr_FR);function daysBetween(a,b){function c(g){const h=new Date(g);return h.setMinutes(h.getMinutes()-h.getTimezoneOffset()),h}return Math.round((c(b)-c(a))/86400000)}function decodeFile(a){const b=d3.dsv(",","text/semi-column");b(a.name,function(c,f){if(c)throw new Error(c);processFile(f)})}function processFile(a){function b(_){return t.findIndex(aa=>aa.value>_.montant)}const f=d3.time.format("%y%m%d"),g=_=>new Date("20"+_.slice(0,2),+_.slice(2,4)-1,_.slice(4,6));a.forEach(function(_){_.date=g(_.date),_.echeance=g(_.echeance),_.reglement=g(_.reglement),_.montant=+_.montant});d3.min(a,_=>_.date);let j=d3.max(a,_=>_.date);const k=d3.max(a,_=>_.echeance);j=j>k?j:k,a.forEach(_=>{_.reglement||(_.reglement=j)});const l=crossfilter(a),m=l.groupAll(),n=dc.barChart("#age-chart"),o=l.dimension(_=>daysBetween(_.date,_.reglement)),q=o.group().reduceSum(_=>_.montant);n.height(200).margins({top:10,right:10,bottom:20,left:40}).dimension(o).group(q).transitionDuration(500).centerBar(!1).gap(4).brushOn(!0).elasticY(!0).x(d3.scale.linear().domain([0,400])),n.yAxis().tickFormat(d3.format(".2s"));const r=dc.dataCount("#data-count");r.dimension(l).group(m);const s=dc.barChart("#amount-chart"),t=[{label:"- infinity",value:-1e8},{label:"<500",value:500},{label:"<2.000",value:2e3},{label:"<10.000",value:1e4},{label:"> 10.000",value:1e9}],u=l.dimension(_=>b(_)),w=u.group().reduceSum(_=>_.montant),x=u.group().reduceCount(_=>_.montant),y=new Date(u.bottom(1)[0].montant),z=new Date(u.top(1)[0].montant);s.width(200).height(200).margins({top:10,right:10,bottom:20,left:40}).dimension(u).group(x).brushOn(!0).transitionDuration(500).centerBar(!1).gap(2).elasticY(!0).xUnits(dc.units.ordinal),s.yAxis().tickFormat(d3.format(".2s")),s.x(d3.scale.ordinal()),s.xAxis().tickFormat(_=>t[_].label);const A=dc.rowChart("#type-chart"),B=l.dimension(_=>_.type),D=B.group().reduceSum(_=>_.montant);A.width(300).height(200).group(D).dimension(B).label(_=>_.key).gap(3).ordering(_=>-_.value).elasticX(!0).xAxis().tickFormat(d3.format(".2s"));const E=dc.barChart("#time-chart"),F=l.dimension(_=>d3.time.week(_.date)),G=F.group().reduceCount(_=>_.montant),H=F.group().reduceSum(_=>_.montant),I=new Date(F.bottom(1)[0].date.getFullYear(),F.bottom(1)[0].date.getMonth(),1),J=new Date(F.top(1)[0].date.getFullYear(),F.top(1)[0].date.getMonth()+1,1);E.width(500).height(200).margins({top:10,right:10,bottom:20,left:40}).dimension(F).group(H).transitionDuration(500).centerBar(!1).gap(4).brushOn(!0).elasticY(!0).x(d3.time.scale().domain([I,J])),E.xUnits(d3.time.weeks),E.xAxis().tickFormat(FR.timeFormat("%b")),E.yAxis().tickFormat(d3.format(".2s"));const K=dc.barChart("#regl-chart"),L=l.dimension(_=>d3.time.week(_.reglement)),M=L.group().reduceSum(_=>_.montant),N=new Date(F.bottom(1)[0].reglement.getFullYear(),F.bottom(1)[0].reglement.getMonth(),1),O=new Date(F.top(1)[0].reglement.getFullYear(),F.top(1)[0].reglement.getMonth()+1,1);K.width(500).height(200).margins({top:10,right:10,bottom:20,left:40}).dimension(L).group(M).transitionDuration(500).centerBar(!1).gap(4).brushOn(!0).elasticY(!0).x(d3.time.scale().domain([N,O])),K.xUnits(d3.time.weeks),K.xAxis().tickFormat(FR.timeFormat("%b")),K.yAxis().tickFormat(d3.format(".2s"));const P=dc.dataTable("#client-table"),Q=l.dimension(_=>_.client),R=Q.group().reduce(function(_,aa){return++_.number,_.total+=+aa.montant,_},function(_,aa){return--_.number,_.total-=+aa.montant,_},function(){return{number:0,total:0}}),T=function(){let _=0,aa={};return aa.cumul=function(ba){return _+=ba,_},aa.reset=function(){_=0},aa}();P.width(768).height(480).dimension(R.order(_=>_.total)).group(()=>"").size(20).columns([{label:"client",format:_=>_.key},{label:"total",format:_=>d3.format(".2s")(_.value.total)},{label:"%total",format:_=>d3.format(".1%")(_.value.total/W)},{label:"%cumul",format:_=>{return d3.format(".1%")(T.cumul(_.value.total)/W)}}]).sortBy(_=>_.value.total).order(d3.descending);let U=l.dimension(_=>_.montant),V=U.groupAll().reduceSum(_=>_.montant),W=Math.max(1,V.value());d3.select("#total").html(d3.format(".2s")(W)),P.on("preRender",function(){T.reset()}),P.on("preRedraw",function(){T.reset(),W=Math.max(1,V.value()),d3.select("#total").html(d3.format(".2s")(W))});const X=dc.dataTable("#client-tableA"),Y=l.dimension(_=>_.agence),Z=Y.group().reduce(function(_,aa){return++_.number,_.total+=+aa.montant,_},function(_,aa){return--_.number,_.total-=+aa.montant,_},function(){return{number:0,total:0}});X.width(768).height(480).dimension(Z.order(_=>_.total)).group(()=>"").size(20).columns([{label:"agence",format:_=>_.key},{label:"total",format:_=>d3.format(".2s")(_.value.total)},{label:"%total",format:_=>d3.format(".1%")(_.value.total/W)}]).sortBy(_=>_.value.total).order(d3.descending),dc.renderAll()}zdrop.ondragover=function(a){a.preventDefault(),a.dataTransfer.dropEffect="copy"},zdrop.ondragenter=function(a){zdrop.style.backgroundColor="LightGreen",a.preventDefault()},zdrop.ondrop=function(a){a.preventDefault(),zdrop.style.backgroundColor="white";let b=event.dataTransfer.files[0];const c=new FileReader;c.onload=function(){let g=d3.dsv(","),h=g.parse(c.result);processFile(h)},c.onerror=function(){throw fileError(),"Error reading CSV file"},c.readAsText(b)},decodeFile({name:"out.csv"});